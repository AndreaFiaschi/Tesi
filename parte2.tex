\chapter{Il ROC prototipo RD53A}
\label{cap:RD53A}

Lo sviluppo di un sistema di alimentazione seriale e, in particolare, del circuito di alimentazione ShuntLDO, che gestisce localmente le tensioni su chip, è parte integrante del ROC che viene sviluppato nell'ambito della collaborazione RD53~\cite{RD53} e, in particolare, del primo ROC prototipo messo a punto dalla collaborazione, RD53A~\cite{RD53A}, che \`e diventato disponibile per la comunit\`a scientifica alla fine del 2017.

Questo prototipo costituisce una pietra miliare molto importante per il progetto dei rivelatori a pixel per HL-LHC \`e sar\`a utilizzato non solo per validare le scelte strettamente relative al ROC stesso (resistenza alla radiazione e prestazioni rispetto ai requisiti di HL-LHC), ma anche per finalizzare lo sviluppo dei sensori e del resto dell'apparato.
%, e quindi la tolleranza al danneggiamento da radiazioni, soglie di lavoro basse e stabili nel tempo, capacità di gestire un alto flusso di particelle incidenti e l'utilizzo di trigger veloci.

\section{Organizzazione del chip, alimentazione e Front End}
\label{Organizzazionechip}


\begin{figure}
\centering
\includegraphics[scale=.4]{Immagini/RD53ALayout}
\caption{La geometria reale di RD53A: il chip è largo $20\mm \times 11.8\mm$ con una pixel matrix di $400\times 192$ pixel corrispondenti ad una area attiva di $20\mm \times 9.6\mm$.}
\label{RD53ALayout}
\end{figure}
\begin{figure}
\centering
\includegraphics[scale=.5]{Immagini/AnalogIsland}
\caption{Disegno ricavato dalle maschere di RD53A dove sono visibili le `isole analogiche' dei \textit{front end} della `pixel matrix' circondate dal `mare' della circuiteria digitale.}
\label{AnalogIsland}
\end{figure} 
Facendo riferimento alla Fig.~\ref{RD53ALayout}, l'area del chip che sarà saldata col sensore tramite bump bonding, detta anche {\em pixel matrix}, è posta nella parte alta ed è organizzata in una matrice di $192\times400$ pixel di area $50\um \times 50 \um$ per un'area totale di $20\mm \times 9.6\mm$.
Al di sopra di questa è presente una fila di piazzole a scopo diagnostico che sarà eliminata nella versione finale.

La matrice di pixel è organizzata in \textit{cores} di 8$\times$8 pixel, all'interno di ciascuno dei quali i 64 circuiti di preamplificzione (front end) sono disposti in regioni di 4, chiamati {\em isole analogiche}, come mostrato in Fig.~\ref{AnalogIsland}. 
Dato la miniaturizzazione necessaria, l'area del ROC deve essere completamente sfruttata e, per questo, le isole analogiche sono circondate da un `mare' di circuiteria digitale. 


\begin{figure}
\centering
\includegraphics[width=0.8\textwidth]{Immagini/RD53Apianofunzionale}
\caption{Il piano funzionale di RD53A in cui, nella parte bassa, sono visibili, in particolare, le piazzole di potenza dello ShuntLDO.}
\label{RD53AFunct}
\end{figure}
Come rappresentato nel piano funzionale in Fig.~\ref{RD53AFunct}, al di sotto delle pixel matrix \`e collocata la regione detta `periferia' che, oltre alle piazzole di microsaldatura per la connessione del ROC, ospita tutti gli altri blocchi funzionali: l'{\em Analog Chip Bottom} (ACB) ospita i blocchi analogici (DAC, ADC, sensori di temperatura...); il {\em Digital Chip Bottom} (DCB) raggruppa i blocchi digitali per la gestione dell'Input/Output e della configurazione. Tenendo conto della periferia la dimensione totale del chip \`e $20\mm \times 11.8\mm$.

L'alimentazione di RD53A \`e dimensionata su un numero di pixel doppio rispetto a quelli effettivamente presenti, comparabile per\`o con quello che sar\`a il ROC finale di superficie circa doppia. RD53A sar\`a normalmente alimentato tramite un'unica linea di alimentazione seriale che servirà lo ShuntLDO che fornisce VDDD (la tensione di alimentazione della parte digitale) e lo ShuntLDO che fornisce VDDA (la tensione di alimentazione della parte analogica). Essendo un prototipo \`e anche possibile alimentare direttamente le linee VDDD e VDDA scavalcando la regolazione.
Come accennato in precedenza, la parte dello ShuntLDO in cui viene dissipata molta potenza (il mosfet di shunt M4), \`e distribuita in quattro `piazzole di potenza' per ciascun regolatore, ospitate nella periferia (come visibile in~Fig.~\ref{RD53AFunct}). Solo una di queste contiene la parte comune di controllo dello ShuntLDO. Questo accorgimento permette di distribuire la dissipazione di calore dovuta allo shunt conferendo una maggiore affidabilità. Ciascuna piazzola \`e stata dimensionata in base al previsto consumo totale del chip finale, ovvero per una corrente massima di $500\mA$ per un totale di $4.0\A$ per l'intero ROC, tenendo conto sia della parte digitale che analogica.

%\section{Front End}

Dato che RD53A non deve essere inteso come il prodotto finale, ma come un prototipo in cui coesistono varie possibili linee di sviluppo, al suo interno sono presenti tre differenti tipologie di circuiti di preamplificazione di front end (FE) per permettere un confronto in termini di prestazioni.
% possiede molte modifiche di design utili solo in una prima fase di test, ad esempio al suo interno sono presenti tre diversi front end (FE), già questo causa una non uniformità del chip. 
La pixel matrix \`e suddivisa equamente tra i FE Sincrono, Lineare e Differenziale come visibile in Fig.~\ref{FrontEnd}. 
%Questi tre circuiti sono stati progettati da tre differenti gruppi e tra di loro ci sono importanti differenze.

Il FE Sincrono sfrutta un sistema di \textit{auto-zeroing} della linea di base, campionandola periodicamente, invece di aggiustare la soglia pixel per pixel. 
Il FE Lineare utilizza un amplificatore lineare all'ingresso del comparatore, che confronta il segnale con la soglia impostata. 
Il FE Differenziale ha uno stadio di guadagno differenziale all'ingresso del discriminatore. % e sbilanciando i due canali implementa la soglia.

In comune ai tre FE, invece, abbiamo la rete di polarizzazione per il sensore ed il circuito per iniettare segnali di calibrazione. Indipendentemente dall'implementazione ciascun canale di lettura \`e caratterizzato da una certa soglia, normalmente espressa in carica equivalente, oltre la quale il segnale di particella viene digitalizzato e letto. La soglia deve essere accuratamente calibrata: se \`e troppo alta si possono avere inefficienze; se troppo bassa una fluttuazione di rumore pu\`o essere confusa con un segnale di particella.

%Questi ultimi due permettono un miglior confronto fra le prestazioni dei FE.
%Inoltre, i tre FE condividono l'area del sensore e, dato che la matrice è larga 400 pixel ed è suddivisa in core da 8 $\times$ 8 pixel, non è possibile avere una egual area per i tre, ma due avranno 17 core per riga ed uno solo 16.
%I FE Lineare e Differenziale sono stati posti accanto in quanto hanno funzionalità simili e metterli vicino consente di avere un'area con una risposta più uniforme anche in termini di consumi. 
\begin{figure}
\centering
\includegraphics[scale=.3]{Immagini/FrontEnd}
\caption{Disposizione dei tre differenti \textit{front end} rispetto alla matrice di pixel.}
\label{FrontEnd}
\end{figure}

% Descriviamo ora brevemente il funzionamento di ciascuno dei tre Front End:

% \begin{itemize}

% \begin{figure}
% \centering
% \includegraphics[width=\textwidth]{Immagini/SchemaSincrono}
% \caption{Schema semplificato del \textit{front end} Sincrono.}
% \label{SchemaSincrono}
% \end{figure}
% \item \textbf{Sincrono}. Il FE Sincrono, il cui schema è visibile in Fig.~\ref{SchemaSincrono}, \`e costituito da un amplificatore di carica (\textit{Charge Sensitive Amplifier} o CSA) a stadio singolo con un Krummenacher feedback accoppiato in AC ad un discriminatore sincrono, formato da un amplificatore differenziale e un latch di feedback positivo. 
% Il Krummenacher feedback è progettato in modo da compensare sia la corrente di buio del sensore sia la corrente di scarica della capacità presente nell'anello di reazione. 
% Maggiore la corrente maggiore la velocità con cui il segnale del preamplificatore torna al valore di \textit{baseline}.
% %Si tenga presente, come riferimento, che una carica di 10k$e^{-}$ e che produce un segnale di $10\nA$ di corrente e $400\ns$ di durata viene ridotta ad un segnale di $40\nA$ di corrente di $100\ns$.   
% %Per avere due differenti valori di guadagno, ci sono due capacità, rispettivamente di 2.5 fF e 4 fF. 
% A causa dei limiti della tecnologia a $65\nm$, si hanno fluttuazioni della \textit{baseline} in uscita dal primo stadio dell'ordine delle decine di millivolt tra un canale e l'altro e questa \`e la ragione dell'accoppiamento in AC del discriminatore. 
% In ogni caso le differenze tra transistor si traducono in un offset della tensione in uscita dal discriminatore tra i vari pixel. 
% Questo effetto, normalmente, è compensato con DAC locali che permettono regolazioni fini. 
% Nel FE Sincrono, invece, l'offset è compensato attraverso un meccanismo di auto azzeramento (\textit{auto zeroing}). 
% Per fare ciò è necessaria l'acquisizione del livello di tensione della \textit{baseline} ogni $100\us$s o meno.
% Durante le collisioni, la differenza tra segnale e baseline è inviata ad uno stadio di confronto che genera il segnale di uscita del discriminatore.

% \begin{figure}
% \centering
% \includegraphics[width=\textwidth]{Immagini/SchemaLineare}
% \caption{Schema semplificato del \textit{front end} Lineare.}
% \label{SchemaLineare}
% \end{figure}
% \item \textbf{Lineare}. Lo schema semplificato del 
% Il FE Lineare è mostrato in Fig.~\ref{SchemaLineare}. Il circuito di lettura include un amplificatore di carica con un Krummenacher feedback per far fronte all'aumento di corrente di dispersione indotta dagli alti livelli di radiazione attesa. 
% La scelta di un amplificatore a stadio singolo è dettata dai limiti sui consumi e sullo spazio disponibile all'interno del chip. 
% Il segnale ottenuto dall'amplificatore di carica è mandato ad un comparatore che, insieme al contatore ToT (\textit{Time over Threshold}), è utilizzato per fare la conversione a segnale digitale. 
% Gli aggiustamenti della tensione di soglia sono gestiti, canale per canale, da un circuito locale basato su un \textit{binary weighted} DAC, a 4 bit, che genera una corrente $\mathrm{I_{DAC}}$, fornendo una regolazione locale della soglia. 
% Questo tipo di front end è stato ottimizzato per una carica massima di 30000 elettroni e un consumo complessivo di circa 4 $\mu$A. 
% L'amplificatore può essere utilizzato in regime di alto o basso guadagno, modificando il bit GAIN$\_$SEL, mentre la corrente di recupero, $\mathrm{I_K}$/2, proveniente dal circuito di Krummenacher feedback, può essere configurata tramite un DAC. 
% In configurazione di alto guadagno, per un segnale di carica pari a 30000, elettroni si ha un ToT di circa 400 ns, risultante in una corrente $\mathrm{I_K}$ di 25 nA. 
% La risoluzione attesa è di 15 mV/k$e^{-}$, mentre diventa di 7.5 mV/k$e^{-}$ in configurazione di basso guadagno. 
% Le prestazioni del preamplificatore di carica sono determinate, principalmente, dall'ingresso dell'amplificatore di carica e dalla parte del circuito di feedback con transistor PMOS. Dalle simulazioni il rumore in carica equivalente, per un rivelatore con capacità di 50 fF, è di 87 elettroni e, dopo la messa a punto, la dispersione della soglia scende da 380 a 35 elettroni.
% %Da simulazioni la dispersione della soglia dovrebbe passare da 380 elettroni a 35 elettroni dopo la messa a punto.

% \begin{figure}
% \centering
% \includegraphics[scale=.3]{Immagini/SchemaDifferenziale}
% \caption{Schema semplificato del \textit{front end} Differenziale.}
% \label{SchemaDifferenziale}
% \end{figure}
% \item \textbf{Differenziale}. Il front end Differenziale è un circuito puramente analogico: non ha al suo interno latches, flip-flop o contatori. 
% I valori di configurazione sono, però, forniti da un nucleo digitale, che riceve dalla parte analogica solo il segnale in uscita del comparatore. 
% Naturalmente è necessaria la presenza di un ADC per la digitalizzazione del ToT ottenuto dal comparatore, anch'esso implementato interamente nella parte digitale. 
% Lo schema a blocchi del front end differenziale è riportato in figura \ref{SchemaDifferenziale}. 
% Il pre amplificatore, presente nel primo stadio, ha un guadagno continuo, regolabile tra i due valori di capacità presenti nell'anello di reazione.
% Il feedback in corrente è impostabile globalmente e non può essere regolato su ogni singolo pixel. 
% Dalle misure sui prototipi è stato visto che la dispersione nei valori di ToT che ne consegue ha un livello accettabile anche senza la necessità di una pre regolazione.  
% In caso di assenza di segnale, il feedback assicura che input e output del preamplificatore siano allo stesso potenziale.
% Nel secondo stadio, il pre comparatore fornisce un guadagno aggiuntivo e agisce come soglia differenziale.
% La soglia globale può essere regolata tramite le tensioni VTH1 e VTH2, mentre localmente la soglia è modificata utilizzando un \textit{resistor ladder} a 4 bit in ciascuno dei due rami del pre comparatore.
% Oltre ai 4 bit ce n'è un quinto che seleziona il ramo da modificare. 
% Dopo il pre comparatore si ha uno stadio con un comparatore, la cui uscita è collegata alla regione digitale tramite porte logiche. 
% Progettato per operare con una soglia di 500 elettroni, la parte analogica ha un consumo di 4$\mu$A/pixel, considerando una capacità di 50 fF e 10 nA di corrente dispersa.

% \end{itemize}

\section{Lo ShuntLDO di RD53A}
\begin{figure}
\centering
\includegraphics[width=\textwidth]{Immagini/SLDO_RD53A}
\caption{Regolatore LDO con Shunt (ShuntLDO) nella versione implementata in RD53A.}
\label{SLDO_RD53A}
\end{figure}
In RD53A l'alimentazione è gestita da due ShuntLDO, uno per la parte analogica ed uno per quella digitale, in cui la parte di potenza \`e distribuita nella periferia come descritto in precedenza. Rispetto al circuito ShuntLDO prototipo a $2\A$ descritto nella Sezione~\ref{ShuntLDO2A}, la tensione di offset $\mathrm{V_{ofs}}$ è generata con una circuiteria migliorata. Lo schema del circuito di ShuntLDO è riportato in Fig.~\ref{SLDO_RD53A}, mentre i pi\`u importanti parametri di funzionamento sono riportati in Tabella~\ref{tab:sldord53a}:

%\begin{center}
\begin{table}
\begin{small}
\noindent\setlength\tabcolsep{4pt}%
\begin{tabularx}{\linewidth}{c|c|c|c|c|X}
%\begin{tabular}{|c|c|c|c|c|l|}
%\hline
\textbf{Pin} & \textbf{Tipologia} & \textbf{Min} & \textbf{Tipico} & \textbf{Max} & \textbf{Descrizione} \\ \hline
$\Vin$ & Tensione & 1.4 V & & 2.0 V & Alimentazione esterna (in tensione)\\
 & Corrente & 0 A & 0.5 A & 2.0 A & Alimentazione esterna (in corrente)\\ \hline 
$\mathrm{V_{SHUNT}}$ & Tensione & 1.4 V & & 2.0 V & Alimentazione per il circuito di shunt; a $\mathrm{\Vin}$ per operare con lo shunt, sconnesso in caso di alimentazione diretta\\ \hline
GND & Ground &  & &  & Riferimento locale e uscita della corrente di shunt\\ \hline
VDD & Tensione & 1.0 V & 1.2 V & 1.32 V & Tensione di uscita $\VDD$ del regolatore\\ \hline
$\mathrm{V_{ref}}$ & Analogico & 500 mV & 600 mV & 660 mV & Tensione di riferimento (VDD=2$\mathrm{V_{ref}}$)\\ \hline
$\mathrm{R_{INT}}$ & Analogico &  & $\mathrm{\Vin}$ &  & Connesso $\mathrm{\Vin}$ abilita la resistenza interna\\ \hline
$\mathrm{R_{EXT}}$ & Analogico & $300\Ohm$ &  &  & Terminale per una resistenza esterna da connettere a $\mathrm{\Vin}$\\ \hline
$\mathrm{I_{OFS}}$ & Analogico &  & $200\kOhm$ &  & Terminale per una resistenza esterna da connettere a GND per configurare $\mathrm{V_{ofs}}$ esternamente\\ \hline
$\mathrm{COMP_{ENB}}$ & Digitale &  & GND &  & A GND abilita il circuito di compensazione per capacit\`a di uscita a bassa resistenza serie equivalente ({\em ESR})\\
%\hline
\end{tabularx}
\end{small}
\caption{I terminali di configurazione e regolazione dello ShuntLDO di RD53A.}
\label{tab:sldord53a}
\end{table}
%\end{center}

Il valore di $\mathrm{V_{ofs}}$ è determinato tramite il terminale $\mathrm{I_{ofs}}$ previsto per connettervi un resistore $\mathrm{R_{iofs}}$ verso $GND$ definendo cos\`i la tensione $\mathrm{V_{+A5}}$ all'ingresso non invertente di A5. La sorgente di corrente $\mathrm{I_{ofs}}$ fornisce $2\uA$ e quindi
\begin{equation}
\label{eq:V+a5}
\mathrm{V_{+A5} = 2 \uA \cdot R_{iofs}}
\end{equation}
tensione che viene poi raddoppiata sull'ingresso di A4 tramite il partitore R4/R5 sull'anello di reazione di A5. Ne consegue che:
\begin{equation}
\label{eq:Vofs}
\mathrm{V_{ofs} = 2\cdot 2\uA \cdot R_{iofs}}.
\end{equation}
%\begin{equation}
%\mathrm{V_{in}= 2 \cdot V_{iofs} + \dfrac{R3}{1000} \cdot I_{in}}
%\end{equation}
Le misure presentate nelle sezioni successive sono stati ottenuti con i seguenti valori di R3 e $\mathrm{R_{iofs}}$:
\begin{center}
\begin{tabular}{lc}
\hline
$\mathrm{R3}$ & $600\Ohm$ \\%misurata con il multimetro è 620
$\mathrm{R_{iofs}}$ & $250\kOhm$\\ 
\hline
\end{tabular}
\end{center}
Tale valore di $\mathrm{R_{iofs}}$ corrisponde a $\mathrm{V_{+A5}\sim0.5\V}$ per cui, nell'andamento della tensione in ingresso in funzione della corrente ci aspettiamo un $\mathrm{V_{ofs}\sim 1\V}$.

Per quanto riguarda le tensioni di riferimento, come $\mathrm{V_{ref}}$, queste vengono generate all'interno del chip da un circuito bandgap dedicato.
La tensione di riferimento del bandgap è configurabile a passi di circa $1\mV$ tramite un registro a 5 bit il cui valore di default \`e 16, corrispondente a una tensione di circa $1.15\V$ che varia leggermente da un chip all'altro.
Un esempio è quello di figura \ref{bandgap_trimming}, in cui sono riportati, per differenti chip, gli andamenti misurati di $\mathrm{V_{ref}}$ al variare del valore impostato sul registro di configurazione. Per valori troppo piccoli di $\mathrm{V_{ref}}$ (che definiscono VDDA e VDDD) il ROC smette di funzionare e per questo motivo la parte sinistra del grafico non \`e popolata.
\begin{figure}
\centering
\includegraphics[scale=.5]{Immagini/bandgap_trimming}
\caption{Andamento della tensione $\mathrm{V_{ref}}$ generata internamente, per due diversi chip (per un totale di quattro bandgap), al variare del parametro di configurazione; il valore di default è 16. In due casi \`e riportata la retta di fit.}
\label{bandgap_trimming}
\end{figure}

\section{La Single Chip Card, scheda di test per RD53A}

Analogamente a quanto visto per gli ShuntLDO, che vengono collaudati usando una scheda di test, anche per il chip RD53A è necessaria una scheda di test detta \textit{Single Chip Card} (SCC) nella versione che ospita un solo ROC, visibile in~Fig.~\ref{fig:RD53onSCC}.
\begin{figure}[t]
\centering
\includegraphics[width=0.4\textwidth]{Immagini/RD53onSCC.jpg}
\caption{Il prototipo di RD53A del gruppo di CMS di Firenze montato sulla sua SCC.}
\label{fig:RD53onSCC}
\end{figure}
 Il chip è fissato al centro di questa scheda e, attraverso microsaldature, è connesso ai vari elementi della scheda (terminali di monitoraggio, connettori di alimentazione, connettori con standard DisplayPort per la trasmissione/ricezione di dati, ponticelli/jumper di configurazione, ecc...). 
Il chip viene montato in un apposito spazio ai cui bordi arrivano le varie piste da connettere e sotto il quale un generoso strato metallico collegato tramite molti `via' al lato opposto della scheda assicura lo scambio termico consentendo, se necessario, l'applicazione di un sistema refrigerante o di un dissipatore sulla parte posteriore della SCC. 
Nel momento in cui l'alimentazione del chip viene fornita dai due ShuntLDO, infatti, la corrente non utilizzata viene dissipata sui due shunt che si scaldano rendendo quindi raccomandabile un minimo di raffreddamento per scongiurare il danneggiamento del chip.
%La presenza di un raffreddamento è necessaria nel momento in cui l'alimentazione è data utilizzando i due ShuntLDO, infatti, la corrente non necessaria al chip viene dissipata sui due shunt che diventano punti molto caldi. 
%Al fine di evitare danneggiamenti del chip, e dell'eventuale sensore collegato, questo va raffreddato utilizzando dissipatori di calore. 

Dal momento che RD53A è un prototipo, si è lasciata la possibilità di configurare l'alimentazione esternamente, scegliendo tra tre diverse configurazioni.
Inoltre, è possibile mantenere separate, a livello di alimentazione, la parte digitale e quella analogica, che nel chip finale si prevede essere in parallelo. Le possibili configurazioni di alimentazione sono sotto elencate e in Fig.~\ref{SLDOmodes} sono riportati gli schemi di configurazione della SCC ad esse relativi.

\begin{description}
\item[Alimentazione con ShuntLDO] In questo caso il generatore utilizzato sarà in corrente. Per operare in configurazione ShuntLDO è necessario l'utilizzo di un sistema di raffreddamento per il chip che, in normali condizioni di lavoro, può essere un semplice dissipatore passivo. Nella misura delle varie tensioni, però, l'effetto di deriva termica non è trascurabile e, quindi, per le future misure, \`e in fase di preparazione un sistema di raffreddamento attivo che permetta di controllare le temperature.

\item[Alimentazione senza Shunt, con solo LDO] Questa configurazione necessita di una alimentazione in tensione e sarà il generatore esterno a dover fornire più o meno corrente in relazione ai consumi del chip. L'utilizzo del solo regolatore permette di avere un consumo ottimizzato in termini di potenza e, dunque, il chip pu\`o essere utilizzato senza il bisogno di un sistema di raffreddamento.

\item[Alimentazione diretta] Lo ShuntLDO viene completamente escluso ed il chip è alimentato direttamente da un generatore di tensione esterno. L'alimentazione diretta deve essere utilizzata con particolare attenzione per evitare danneggiamenti del ROC. La presenza del regolatore LDO, infatti, anche privo di shunt, assicura che sbalzi di tensione all'ingresso dell'alimentazione non siano trasmessi al chip. Il regolatore, inoltre, tollera tensioni fino a 2 V, mentre il chip già sopra $\sim 1.3\V$ rischia di danneggiarsi. L'esclusione di questa sicurezza con la scelta di utilizzare un'alimentazione diretta è, perciò, sconsigliata. 
\end{description}

\begin{figure}[h]
\centering
\includegraphics[width=0.30\textwidth]{Immagini/SLDOmode}
\hfill
\includegraphics[width=0.30\textwidth]{Immagini/LDOmodeDefault}
\hfill
\includegraphics[width=0.30\textwidth]{Immagini/DirectPowering}
\caption{Disposizione dei jumper per le varie configurazioni di alimentazione dell'RD53A. Sinistra: ShuntLDO. Centro: LDO senza la parte di shunt. Destra: alimentazione diretta. In tutti e tre i casi la stessa configurazione \`e usata per la parte analogica e la parte digitale.}
\label{SLDOmodes}
\end{figure}

\section{Caratterizzazione degli ShuntLDO su RD53A}
\label{MisureStaticheRD53A}

\subsection{Misure statiche}

Utilizzando il chip in configurazione ShuntLDO, raffreddato in modo passivo con un radiatore a contatto termico con il retro della SCC, si è proceduto alla caratterizzazione statica del comportamento dei due circuiti di alimentazione presenti nel chip rispettivamente per la parte analogica e per quella digitale.

Questa studio è stato effettuato con diverse configurazioni risultanti dalla combinazione di tre aspetti operativi:
%Nel far questo sono state scelte diverse configurazioni, le scelte principali possono essere riassunte in tre punti:
\begin{itemize}
  \item alimentazione dei due regolatori con ShuntLDO: indipendenti o in parallelo fra loro;
  \item rampa di corrente crescente o decrescente;
  \item tensioni di riferimento $\mathrm{V_{ref}}$ e $\mathrm{V_{+A5}}$: generate internamente o fornite dall'esterno.
%\item Tenere i due regolatori con ShuntLDO in parallelo o con alimentazione indipendenti.
%\item Variare la corrente partendo da 0 A incrementandola via via o partendo da 1.5 A andando poi a decrescere.
%\item Utilizzare $\mathrm{V_{ref}}$ e $\mathrm{V_{iofs}}$ generati internamente o fornirli esternamente.
\end{itemize}

In tabella~\ref{tab:legenda} è riportata la descrizione delle abbreviazioni utilizzate per le legende dei grafici.
\begin{table}
\begin{center}
%\noindent\setlength\tabcolsep{4pt}%
\begin{tabular}{c|l}
%\begin{tabularx}{\linewidth}{c|r}
%\multicolumn{2}{|c|}{Abbreviazione} & \multicolumn{1}{c|}{\multirow{2}{*}{Descrizione}}\\ 
 Abbreviazione & Descrizione\\ \hline
\multicolumn{2}{l}{Parte Analogica} \\
\hline
VINA & Tensione $\mathrm{V_{INA}}$ all'ingresso del regolatore  \\ \hline
VDDA & Tensione $\mathrm{V_{outA}}$ all'uscita del regolatore \\ \hline
$\mathrm{V_{iofs \_ m \_ A}}$ & $\mathrm{V_{+A5A}}$ \\ \hline   
$\mathrm{V_{ref \_ m \_ A}}$  & $\mathrm{V_{refA}}$ \\ \hline \hline  
\multicolumn{2}{l}{Parte Digitale} \\ \hline
% Abbreviazione & Descrizione\\ 
VIND & Tensione $\mathrm{V_{IND}}$ all'ingresso del regolatore  \\ \hline
VDDD & Tensione $\mathrm{V_{outD}}$ all'uscita del regolatore \\ \hline
$\mathrm{V_{iofs \_ m \_ D}}$ & $\mathrm{V_{+A5D}}$ \\ \hline   
$\mathrm{V_{ref \_ m \_ D}}$  & $\mathrm{V_{refD}}$ \\ 
\end{tabular}
\end{center}
\caption{Descrizione delle abbreviazioni utilizzate per le legende dei grafici.}
\label{tab:legenda}
\end{table}

\subsubsection{Alimentazioni indipendenti, rampa di corrente crescente, tensioni di riferimento interne}
\label{sec:iui}

\begin{figure}
\centering
\includegraphics[width=\textwidth]{Immagini/IUI2}
\caption{Grafici tensione-corrente ottenuti tenendo i due regolatori separati e variando le rispettive correnti $\mathrm{I_{in}}$ da $0\A$ a $1.5\A$.}%allungare descrivendo anche l'undershoot
\label{IUI}
\end{figure}
Le prime misure sono state eseguite utilizzando, come riferimento per $\mathrm{V_{out}}$ e $\mathrm{V_{iofs}}$, le tensioni generate internamente al chip.
La corrente fornita ai due ShuntLDO, alimentati indipendentemente, è stata variata, contemporaneamente, da $0\A$ a $1.5\A$ a passi di $10\mA$.
L'andamento ottenuto è quello riportato in Fig.~\ref{IUI}.

La fluttuazione verso il basso ben visibile sulle tensioni della parte analogica, sia in ingresso che in uscita, è causata da uno sbilanciamento nella distribuzione delle correnti nei due ShuntLDO: quando si attiva la parte digitale si ha un picco di assorbimento di corrente a scapito della parte analogica che risulta nelle fluttuazioni riassunte in tabella.
\begin{center}
\begin{tabular}{ccc}
\hline
$\Delta \mathrm{V_{INA}}$ & $\Delta \mathrm{V_{refA}}$ &$\Delta \mathrm{V_{outA}}$  \\ \hline
$\sim$0.150 V & $\sim$ 0.030 V& $\sim$0.060 V\\ \hline     
\end{tabular}.
\end{center}
Questo fenomeno è stato osservato nonostante la configurazione sia tale da avere i due ShuntLDO, per la parte digitale e analogica, alimentati separatamente, segno che, all'interno del chip, sono presenti fenomeni di `dialogo' fra i due ambiti: un po' di corrente scorre attraverso le connessioni tra le due regioni, causando la caduta di tensione osservate nella parte analogica.
%Questo avviene nonostante le alimentazioni dei due ShuntLDO siano separate, in quanto all'interno del chip ci sono zone di 'dialogo' tra regione analogica e digitale. 
%Si ha scorrimento di corrente attraverso connessioni tra le due regioni che causano cadute di tensioni nella parte analogica, questo comportamento è pericoloso e va evitato. 
Questo comportamento è potenzialmente dannoso perch\'e pu\`o alterare la corretta sequenza di accensione con il rischio di fenomeni di oscillazione o che il ROC finisca in uno stato anomalo senza possibilit\`a di recupero.

Inoltre, sempre dalla Fig.~\ref{IUI}, si può notare che $\mathrm{V_{outD}}$ sale parzialmente quando $\mathrm{I_{in}}$ raggiunge $\sim0.56\A$, non riuscendo però ad andare a regime, poiché la tensione $\mathrm{V_{IND}}$ non è ancora sufficientemente abbastanza elevata da consentire una corretta regolazione. Questo, a sua volta, è dovuto al ritardo con cui $\mathrm{V_{+A5D}}$ raggiunge il valore corretto, solo per $\mathrm{I_{in}\sim 1.1\V}$. Infatti, come introdotto in precedenza, la tensione  $\mathrm{V_{+A5D}}$ è ottenuta dalla caduta di tensione sulla resistenza $\mathrm{R_{iofs}}$, nel nostro caso di $\sim 250\kOhm$, indotta dalla corrente $\mathrm{I_{ofs} \sim 2 \uA}$. Se, per vari motivi, il circuito che genera questa corrente ha un ritardo nell'accensione, questo si ripercuote nell'accensione del ROC nel suo complesso.  

Questa discussione illustra come le problematiche di {\em power-on} siano cruciali e crescano di complessit\`a quando il circuito base (lo ShuntLDO nel nostro caso) viene vestito con tutta la circuiteria addizionale. Il ROC finale per l'IT dovr\`a essere progettato per essere completamente affidabile rispetto al {\em power on} che, tradizionalmente, \`e un aspetto delicato dell'elettronica digitale. Questo \`e vero in particolare in presenza del danneggiamento da radiazione che altera le caratteristiche circuitali per cui, potenzialmente, certe problematiche possono non essere presenti nel ROC non irraggiato e comparire dopo che lo stesso ha integrato una certa fluenza. La validazione del ROC non pu\`o prescidere da una estesa campagna di test dopo irraggiamento.

Le cause del diverso comportamento di $\mathrm{V_{+A5A}}$ e $\mathrm{V_{+A5D}}$ rispetto ai valori di corrente $\mathrm{I_{in}}$ che sono necessari perch\`e queste due tensioni raggiungano il livello nominale non sono comprese al momento. Da disegno i due ShuntLDO e i relativi circuiti addizionali per la parte analogica e la parte digitale sono gemelli e quindi questa differenza \`e inaspettata e probabilmente dovuta a effetti spuri di power-on. Infatti questa asimmetria scompare effettuando la misura una rampa di corrente inversa come illustrato nella prossima sezione.

%\begin{center}
%\begin{tabular}{|l|c|c|c|c|}
%\hline
% & \multicolumn{2}{c|}{Digitale} & \multicolumn{2}{c|}{Analogica} \\ \hline
% 
%& media & errore & media & errore \\ \hline
%
%$\mathrm{R_{eq}}$ & 0.752 $\Omega$ & 0.0003 $\Omega$& 0.7178 $\Omega$ & 0.0003 $\Omega$ \\ \hline
%$\mathrm{V_{ofs}}$ & 0.844 V& 0.004 V & 0.9025 V & 0.0003 V\\ \hline     
%
%\end{tabular}
%\end{center}

%\begin{figure}
%\centering
%\includegraphics[scale=.27]{Immagini/IUISubPlotVofs}
%\caption{.}
%\label{IUISubPlotVofs}
%\end{figure}

%\begin{center}
%\begin{tabular}{|l|c|c|}
%\hline
%&Digitale  &Analogica \\ \hline
%$\mathrm{R_{eq}}$ & 0.753 $\Omega$& 0.724 $\Omega$ \\ \hline
%$\mathrm{V_{ofs}}$ & 0.845 V & 0.900 V\\ \hline
%\end{tabular}
%\end{center}

\subsubsection{Alimentazioni indipendenti, rampa di corrente decrescente, tensioni di riferimento interne}

\begin{figure}
\centering
\includegraphics[width=\textwidth]{Immagini/IDI2}
\caption{Grafici tensione-corrente ottenuti tenendo i due regolatori separati e variando le rispettive correnti $\mathrm{I_{in}}$ da $1.5\A$ a $0\A$.}
\label{IDI}
\end{figure}

Per verificare che i comportamenti anomali descritti nella sezione precendente siano effettivamente legati alla sequenza interna di accensione, si sono ripetute le misure effettuando la scansione in corrente in senso inverso partendo da $\mathrm{I_{in}}\sim1.5\A$ per poi scendere fino a $0\A$. Dagli andamenti mostrati in Fig.~\ref{IDI}, si può notare come siano scomparse le fluttuazioni presenti nella precedente scansione, in accordo con l'ipotesi che queste siano dovute alla parziale attivazione del ROC che risulta compiuta solo per valori pi\`u elevati di $\mathrm{I_{in}}$. 

In assenza di un segnale di clock esterno, il ROC, nella configurazione di default, richiede circa $50\mA$ per la parte digitale e $400\mA$ per quella analogica.
%Questo fin tanto che il chip non riceve un segnale di clock esterno. 
Questa differenza in consumi di corrente si riflette nel fatto che, diminuendo la corrente, il comparto analogico \`e il primo a mostrare problemi con un primo flesso poco i sotto $400\mA$ circa e spegnendosi a $200\mA$ circa. La parte digitale, invece, rimane attiva anche con correnti inferiori.

Partendo da valori di corrente elevati, inoltre, e quindi da tensioni in ingresso ben al di sopra di quelle strettamente necessarie, non si osservano neppure i problemi dovuti ai differenti istanti di accensione delle parti analogica e digitale.
%\begin{center}
%\begin{tabular}{|l|c|c|c|c|}
%\hline
% & \multicolumn{2}{c|}{Digitale} & \multicolumn{2}{c|}{Analogica} \\ \hline
% 
%& media & errore & media & errore \\ \hline
%
%$\mathrm{R_{eq}}$ & 0.73475 $\Omega$ & 0.00008 $\Omega$& 0.7153 $\Omega$ & 0.0006 $\Omega$ \\ \hline
%$\mathrm{V_{ofs}}$ & 0.86530 V& 0.00007 V & 0.9043 V & 0.0005 V\\ \hline     
%
%\end{tabular}
%\end{center}

\subsubsection{Alimentazioni indipendenti, rampa di corrente crescente, $\mathrm{V_{ref}}$ esterna} 

\begin{figure}
\centering
\includegraphics[width=\textwidth]{Immagini/IUEVref2}
\caption{Grafici tensione-corrente ottenuto tenendo i due regolatori separati e variando le rispettive correnti $\mathrm{I_{in}}$ da $0\A$ a $1.5\A$, utilizzando un riferimento esterno $\mathrm{V_{ref}}=0.550 \V$ sia per la parte analogica che digitale.}
\label{IUEVref}
\end{figure}
Continuando a tenere i due circuiti di alimentazione separati è interessante studiare, per confronto, il comportamento nel caso in cui le tensioni di riferimento non siano generate dal ROC stesso.
I grafici riportati in Fig.~\ref{IUEVref} sono ottenuti fornendo esternamente $\mathrm{V_{ref}}=0.550\V$,  sia per la parte analogica che per quella digitale.
Il comportamento della parte digitale è analogo a quello ottenuto di cui in Fig.~\ref{IUI}, mentre, per la parte analogica, non si hanno le fluttuazione osservate n\'e su $\mathrm{V_{INA}}$ n\'e $\mathrm{V_{outA}}$. $\mathrm{V_{outA}}$, però, risente ancora del comportamento della parte digitale: fino a che $\mathrm{V_{ofsD}}$ non arriva al valore nominale per tramite di $\mathrm{V_{+A5D}}$, $\mathrm{V_{outA}}$ non si stabilizza.

%\begin{center}
%\begin{tabular}{|l|c|c|c|c|}
%\hline
% & \multicolumn{2}{c|}{Digitale} & \multicolumn{2}{c|}{Analogica} \\ \hline
% 
%& media & errore & media & errore \\ \hline
%
%$\mathrm{R_{eq}}$ & 0.7539 $\Omega$ & 0.00007 $\Omega$& 0.7448 $\Omega$ & 0.0002 $\Omega$ \\ \hline
%$\mathrm{V_{ofs}}$ & 0.84199 V& 0.00011 V & 0.8706 V & 0.0003 V\\ \hline     
%
%\end{tabular}
%\end{center}

%
% ---------------------- Sono arrivato qui
%

\subsubsection{Alimentazioni indipendenti, rampa di corrente crescente, $\mathrm{V_{+A5}}$ esterna} 

\begin{figure}
\centering
\includegraphics[width=\textwidth]{Immagini/IUEViofs2}
\caption{Grafici tensione-corrente ottenuto tenendo i due regolatori separati e variando le rispettive correnti $\mathrm{I_{in}}$ da $0\A$ a $1.5\A$, utilizzando un riferimento esterno $\mathrm{V_{+A5}}=0.400\V$ sia per la parte analogica che digitale.}
\label{IUEViofs}
\end{figure}
 Le stesse misure sono state ripetute fornendo esternamente il solo $\mathrm{V_{+A5}}=0.400 \V$ e utilizzando $\mathrm{V_{ref}}$ interno sia per la parte analogica che digitale e tenendo le alimentazioni dei due ShuntLDO indipendenti. In questo caso gli andamenti ottenuti sono decisamente migliori, come si vede in Fig.~\ref{IUEViofs}. 
Infatti, i $\mathrm{V_{+A5}}$ esterni permettono di evitare le problematiche precedentemente riscontrate quali i differenti valori di corrente $\mathrm{I_{in}}$, tra parte analogica e digitale, oltre i quali si entra in regime di regolazione. Questo grazie al fatto che il valore di $\mathrm{V_{ofs}}$, grazie al pilotaggio esterno, \`e fissato al valore nominale. %\begin{center}
%\begin{tabular}{|l|c|c|c|c|}
%\hline
% & \multicolumn{2}{c|}{Digitale} & \multicolumn{2}{c|}{Analogica} \\ \hline
% 
%& media & errore & media & errore \\ \hline
%
%$\mathrm{R_{eq}}$ & 0.7871 $\Omega$ & 0.0013 $\Omega$& 0.7554 $\Omega$ & 0.0013 $\Omega$ \\ \hline
%$\mathrm{V_{ofs}}$ & 0.6824 V& 0.0013 V & 0.7403 V & 0.0012 V\\ \hline     
%
%\end{tabular}
%\end{center}

%\begin{figure}
%\centering
%\includegraphics[scale=.3]{Immagini/IUEAll}
%\caption{IUEAll viofs e vref si sovrappongono .}
%\label{IUEAll}
%\end{figure} 
%Infine riportiamo il grafico degli andamenti nal caso in cui sia $\mathrm{V_{ref}}$ che $\mathrm{V_{iofset}}$ sono forniti esternamente. entrambi valgono 0.400, mancanza di kitley

%\begin{center}
%\begin{tabular}{|l|c|c|c|c|}
%\hline
% & \multicolumn{2}{c|}{Digitale} & \multicolumn{2}{c|}{Analogica} \\ \hline
% 
%& media & errore & media & errore \\ \hline
%
%$\mathrm{R_{eq}}$ & 0.7461 $\Omega$ & 0.0004 $\Omega$& 0.7448 $\Omega$ & 0.0004 $\Omega$ \\ \hline
%$\mathrm{V_{ofs}}$ & 0.7452 V& 0.0004 V & 0.7563 V & 0.0004 V\\ \hline 
%\end{tabular}
%\end{center}  

\subsubsection{Alimentazione in parallelo, rampa di corrente crescente, tensioni di riferimento interne} 

\begin{figure}[h]
\centering
\includegraphics[width=\textwidth]{Immagini/PUI}
\caption{Grafici tensione-corrente ottenuti con i due regolatori in parallelo e variando la corrente totale, riportata sull'asse delle ascisse, da $0\A$ a $3\A$.}
\label{PUI}
\end{figure}
Come detto in precedenza, in RD53A è stata lasciata la possibilità di tenere separate le alimentazioni dei due ShuntLDO, mentre nella versione finale i due ShuntLDO si troveranno in parallelo. 
In questa configurazione gli andamenti delle tensioni in ingresso ($\mathrm{V_{INA}}$ e $\mathrm{V_{IND}}$) e di quelle in uscita ($\mathrm{V_{outA}}$ e $\mathrm{V_{outD}}$) risultano migliori, nonostante che $\mathrm{V_{ofsA}}$ e $\mathrm{V_{ofsD}}$ raggiungano il valore nominale per differenti valori di $\mathrm{I_{inA}}$ e $\mathrm{I_{inD}}$ , rispettivamente, come si può vedere in Fig.~\ref{PUI}.
Questo miglioramento nel comportamento può essere attribuito all'utilizzo dell'alimentazione in parallelo dei due ShuntLDO, poiché la corrente totale a disposizione si può suddividere in modo ottimale tra i due ambiti, come effettivamente accade. Questo sbilanciamento nella ripartizione delle correnti si verifica nell'intervallo di correnti in cui $\mathrm{V_{+A5A}}$ \`e gi\`a al valore nominale mentre $\mathrm{V_{+A5D}}$ non lo \`e ancora, come risulta evidente se confrontiamo la Fig.~\ref{CurrentSharing} con gli andamenti di $\mathrm{V_{+A5A}}$ e $\mathrm{V_{+A5D}}$ nella~Fig.~\ref{PUI}.

%\begin{center}
%\begin{tabular}{|l|c|c|c|c|}
%\hline
% & \multicolumn{2}{c|}{Digitale} & \multicolumn{2}{c|}{Analogica} \\ \hline
% 
%& media & errore & media & errore \\ \hline
%
%$\mathrm{R_{eq}}$ & 0.7441 $\Omega$ & 0.0002 $\Omega$& 0.7396 $\Omega$ & 0.0009 $\Omega$ \\ \hline
%$\mathrm{V_{ofs}}$ & 0.8635 V& 0.003 V & 0.8688 V & 0.0011 V\\ \hline 
%\end{tabular}
%\end{center}

\begin{figure}
\centering
\includegraphics[scale=.4]{Immagini/CurrentSharing}
\caption{Misura della suddivisione della corrente tra i due regolatori posti in parallelo; in ascissa è riportata la corrente totale fornita al parallelo.}%meeting del 16 aprile
\label{CurrentSharing}
\end{figure}
Il comportamento descritto è simile a quanto riportato in letteratura~\cite{SLDO} nel caso in cui, per\`o, i due ShuntLDO siano configurati per fornire due tensioni $\mathrm{V_{outA}}$ e $\mathrm{V_{outB}}$ diverse. In particolare si osserva uno sbilanciamento di corrente quando solo uno degli ShuntLDO \`e in regime di regolazione. Sbilanciamento che scompare quando la fase di accensione \`e completata per entrambi.
 
%, la distribuzione delle correnti torna ad essere bilanciata. 
%Questo comportamento è noto e compreso: il meccanismo che lo innesca risiede nell'offset dell'amplificatore A2, utilizzato nel \textit{current mirror}. 
%L'offset, infatti, implica un differente $\mathrm{V_{DS}}$ tra i transistor M1 e M2 influenzando il rapporto k nella regione lineare.
%Dunque, fintantoché in uno dei due regolatori la tensione di uscita è minore di quella di riferimento, si ha uno sbilaciamento delle correnti. 
%Quando viene raggiunto il livello di riferimento, M1 e M2 saturano e l'effetto dell'offset svanisce.
%Questo problema, che si verifica durante l'accensione, può essere mitigato utilizzando particolari architetture con basso offset per l'amplificatore A2.

\subsubsection{Confronti fra le varie configurazioni}

Da ciascuna delle configurazioni discusse nei paragrafi precedenti sono stati ricavati, per la regione di regolazione, i parametri fondamentali $\mathrm{V_{ofs}}$ e $\mathrm{R_{eff}}$ della curva caratteristica $\mathrm{V_{IN}}$ vs. $\mathrm{I_{IN}}$. Idealmente ci aspettiamo che la pendenza sia confrontabile con $\sim\nicefrac{\mathrm{R3}}/1000$ e $\mathrm{V_{ofs}}$ con il doppio di $2\times \mathrm{V_{+A5}}$. A questo proposito ricordiamo che i valori nominali sono 
\begin{center}
\begin{tabular}{lc}
\hline
$\mathrm{R3}$ & $600\kOhm$ \\%misurata con il multimetro è 620
$\mathrm{V_{+A5}}$ & $0.5\V$\\
\hline
\end{tabular}
\end{center}

In tabella~\ref{table:results} sono riportati i risultati di questa analisi. Riguardo alla descrizione della configurazione è specificato se i due regolatori sono alimentati in parallelo o indipendentemente, se la corrente è stata fatta variare in modo crescente o decrescente e se le tensioni di riferimento $\mathrm{V_{+A5}}$, $\mathrm{V_{refA}}$ e $\mathrm{V_{refB}}$ sono generate internamente o esternamente al ROC.

\begin{table}
\begin{center}
\begin{tabular}{l|c|c|c|c|c|c|c|c}
Regolatore & Alim. & Rampa & \multicolumn{2}{c|}{$\mathrm{V_{ref}}$} & \multicolumn{2}{c|}{$\mathrm{V_{+A5}}$} & $\mathrm{R_{eff}}$& $\mathrm{V_{ofs}}$ \\
Regolatore & Alim. & Rampa & \multicolumn{2}{c|}{[V]}               & \multicolumn{2}{c|}{[V]}                & [$\Omega$]       & [V]               \\ \hline
Analogico & \multirow{2}{*}{Indip.} & \multirow{2}{*}{Cres.} & Int. & - & Int. & - & 0.72 & 0.90 \\
Digitale  &  &  & Int. & - & Int. & - & 0.75  & 0.84 \\ \hline

Analogico & \multirow{2}{*}{Indip.} & \multirow{2}{*}{Decr.} & Int. & - & Int. & - & 0.71 & 0.90 \\
Digitale  &  &  & Int. & - & Int. & - & 0.73  & 0.86 \\ \hline

Analogico & \multirow{2}{*}{Indip.} & \multirow{2}{*}{Cres.} & Ext. & 0.550 & Int. & - & 0.75 & 0.87 \\
Digitale  &  &  & Ext. & 0.550 & Int. & - & 0.75  & 0.84 \\ \hline

Analogico & \multirow{2}{*}{Indip.} & \multirow{2}{*}{Cres.} & Int. & - & Ext. & 0.400 & 0.75 & 0.74 \\
Digitale  &  &  & Int. & - & Ext. & 0.400 & 0.79  & 0.68 \\ \hline

Analogico & \multirow{2}{*}{Paral.} & \multirow{2}{*}{Cres.} & Int. & - & Int. & - & 0.74 & 0.87 \\
Digitale  &  &  & Int. & - & Int. & - & 0.74  & 0.86 \\
\end{tabular}
\caption{Valori di $\mathrm{V_{ofs}}$ e $\mathrm{R_{eff}}$ ricavati da un fit alla caratteristica $\mathrm{V_{IN}}$ vs. $\mathrm{I_{IN}}$ nella regione di regolazione dei i due ShuntLDO a seconda della configurazione.}
\label{table:results}
\end{center}
\end{table}


I risultati sono stati ottenuti mediando pi\`u caratteristiche tensione-corrente effettuate nella stessa configurazione. I valori di tensione misurati per una data $\mathrm{V_{IN}}$ sono molto stabili all'interno di ciascun gruppo (variazioni assolute inferiori a $3\mV$, tipicamente di $\sim 1\mV$), mentre i valori estratti di $\mathrm{R_{eff}}$ e di $\mathrm{V_{ofs}}$ variano fra una configurazione e l'altra.
%La prima cosa che si può notare è che i valori variano da una configurazione all'altra, mentre mantenendo per una stessa configurazione rimangono pressochè uguali, infatti i risultati sono stati ottenuti mediando su più misure.
Gli errori statistici associati alla stima di $\mathrm{R_{eff}}$ e di $\mathrm{V_{ofs}}$ sono trascurabili rispetto alle fluttuazioni di questi parametri nelle diverse configurazioni e rispetto ad altri possibili contributi sistematici alle incertezze coem, ad esempio, le variazioni di temperatura. 

\begin{figure}
\centering
\includegraphics[width=\textwidth]{Immagini/R3Karagounis}
\caption{Andamento di $\mathrm{R_{eff}}$ e $\mathrm{V_{ofs}}$ al variare della resistenza esterna $\mathrm{R_{ext}}$ utilizzata per definire la corrente nel ramo di controllo dello ShuntLDO.}%meeting del 13 aprile R^2 https://en.m.wikipedia.org/wiki/Coefficient_of_determination
\label{R3Karagounis}
\end{figure}
Dal confronto con i valori attesi risulta evidente che la pendenza della caretteristica tensione-corrente nella regione di regolazione degli ShuntLDO misurati è sistematicamente maggiore mentre l'offset è sistematicamente minore. 
Questo comportamento è stato osservato in tutti gli esemplari di RD53A utilizzati per lo sudio degli ShuntLDO. \`E stata eseguita, in particolare, una misura dedicata a queste discrepanze studiando l'andamento di $\mathrm{R_{eff}}$ e $\mathrm{V_{ofs}}$ al variare della resistenza $\mathrm{R3}$, ottenuto grazie ad un resistore esterno $\mathrm{R_{ext}}$ regolabile e riportato in Fig.~\ref{R3Karagounis}. La relazione che ne risulta, $\mathrm{R_{eff}} = 0.001\cdot \mathrm{R_{ext}} + 0.1963\Ohm$, si discosta da quella di progetto $\mathrm{R_{eff} = \nicefrac{R_{ext}}{k} = \nicefrac{R3}{k}}$ (con $k=1000$) per la presenza del termine costante pari a circa $0.2\Ohm$ dovuto a qualche contributo spurio che probabilmente varia da esemplare a esemplare. Questa misura conferma i risultati precedentemente ottenuti e giustifica la sistematica osservazione di una $\mathrm{R_{eff}}$ pi\`u grande di quella aspettata. 

Per quanto riguarda l'osservazione di valori di $\mathrm{V_{ofs}}$ inferiori a quanto atteso il fenomeno è di più difficile interpretazione.
%In parte è dovuto alla differenza tra terra del chip e terra dello shunt?!.
\begin{figure}
\centering
\includegraphics[width=\textwidth]{Immagini/OffsetKaragounis}
\caption{Andamento di $\mathrm{R_{eff}}$ e $\mathrm{V_{ofs}}$ al variare della tensione $\mathrm{V_{+A5}}$ fornita esternamente.}%meeting del 13 aprile
\label{OffsetKaragounis}
\end{figure}
In questo caso l'andamento di $\mathrm{R_{eff}}$ e $\mathrm{V_{ofs}}$ al variare della tensione $\mathrm{V_{+A5}}$ fornita esternamente visibile in Fig.~\ref{OffsetKaragounis}, mostra che $\mathrm{V_{ofs} = 2.215\cdot V_{+A5}- 0.169\V}$. Il fattore moltiplicativo \`e maggiore di circa il 10\% rispetto a quello di progetto nominalmente pari a 2. Inoltre \`e presente un termine costante non nullo. Infine, entrambe le misure delle Figure~\ref{R3Karagounis} e ~\ref{OffsetKaragounis} suggeriscono l'esistenza di una correlazione tra $\mathrm{V_{ofs}}$ e $\mathrm{R_{eff}}$. L'origine di questi comportamenti anomali rispetto al progetto del ROC non \`e nota al momento ma studi approfonditi e simulazioni sono in corso per per comprenderne le cause ed eliminarle.

%
% ------------------------------------
%
\subsection{Variazioni di carico}
\label{VariazioniCarico}

\begin{figure}
\centering
\includegraphics[width=\textwidth]{Immagini/LoadVDDD}
\includegraphics[width=\textwidth]{Immagini/LoadVIND}
\caption{Andamento di $\VDDA$ e $\VDDD$ (grafici in alto) e della tensione di ingresso $\Vin$ (grafico in basso) in funzione della maggiore corrente $\Iload$ assorbita dal carico su $\VDDD$.}
\label{LoadVDDD}
\label{LoadVIND}
\end{figure}

Per gli ShuntLDO il carico è rappresentato dal nucleo del ROC che, fino a che si trova nella configurazione di default, ha consumi di corrente tipici pari a:
\begin{center}
\begin{tabular}{cc}
\hline
Regione Analogica & Regione Digitale \\ \hline
$\sim$0.400 A & $\sim$ 0.050 A\\ \hline     
\end{tabular}
\end{center}
in quanto la parte digitale rimane dormiente se non viene fornito alcun clock esterno.

Le misure riportate di seguito sono ottenute variando la corrente di carico su $\VDDA$ e $\VDDD$ di una quantit\`a $\Iload$, ponendo sui nodi $\VDDA$ e $\VDDD$ un source-meter Keithley 2410~\cite{2410} utilizzato come pozzo di corrente. L'alimentazione del ROC \`e stata configurata con i due ShuntLDO in parallelo con una $\Iin$ totale in ingresso pari a $2\A$, corrispondenti ad $\sim 1\A$ per ciascun ShuntLDO. Dati i diversi consumi di partenza tra la parte analogica e digitale, si sono scelti due diversi intervalli di variazione per $\Iload$: tra $0\A$ e $1\A$ per la parte digitale e tra $0\A$ e $0.7\A$ per la parte analogica. Ad ogni incremento del valore del carico le tensioni di ingresso e di uscita vengono misurate in condizioni stazionarie ovvero su tempi scala lunghi rispetto a quelli di risposta del circuito di ShuntLDO ignorando quindi i transienti veloci.
Gli andamenti riportati di seguito vanno quindi interpretati come una deriva del valore della tensione prodotta dal regolatore in funzione dell'entità del carico. 

In Fig.~\ref{LoadVDDD} sono mostrati gli andamenti ottenuti con la variazione di carico applicata alla parte digitale. Come si può vedere, $\VDDD$ diminuisce gradualmente, arrivando ad una variazione di $\sim 18\mV$ per un carico addizionale di $1\A$.  $\VDDA$, invece, rimane costante. %pendenza 18 mOhm(ogni 100 mA 1.8 mV
L'andamento della tensione in ingresso ha invece una pi\`u repentina caduta di $\sim 24\mV$ nella parte finale, per $\Iload \gtrsim 0.94\A$. Questo comportamento è plausibile se si considera che, aggiungendo i $\sim 50\mA$ effettivamente consumati dal nucleo digitale del ROC, si arriva ad un consumo totale prossimo a $1\A$ che \`e la corrente disponibile allo ShuntLDO digitale.
\begin{figure}
\centering
\includegraphics[width=\textwidth]{Immagini/LoadVDDA}
\includegraphics[width=\textwidth]{Immagini/LoadVINA}
\caption{Andamento di $\VDDA$ e $\VDDD$ (grafici in alto) e della tensione di ingresso $\Vin$ (grafico in basso) in funzione della maggiore corrente $\Iload$ assorbita dal carico su $\VDDA$.}
\label{LoadVDDA}
\label{LoadVINA}
\end{figure}
Con l'aiuto della Fig.~\ref{LoadVDDA}, un discorso analogo si può fare per la parte analogica, tenendo presente che, in questo caso, il valore di consumo di partenza \`e $\sim 400\mA$.
$\VDDA$ scende gradualmente fino a raggiungere $\sim -15\mV$ per un carico addizionale di $\sim 0.70\A$. $\Vin$, invece, diminuisce di $\sim 26\mV$ in corrispondenza del massimo carico aggiuntivo (per $\Iload \gtrsim 0.6\A$) e, anche in questo caso, il consumo totale di corrente supera $1\A$. 

%\subsection{}

Le misure fino ad ora riportate relative allo studio dei circuiti di ShuntLDO in RD53A sono da considerarsi stazionarie, in quanto ottenute su tempi scala lunghi in confronto ai tempi di risposta dello ShuntLDO. In questa sezione accenneremo, invece, al comportamento dello ShuntLDO sui transienti.
 
\begin{figure}
\centering
\includegraphics[width=0.65\textwidth]{Immagini/HeadRoom}
\caption{Illustrazione del metodo di misura delle fluttuazioni di $\VDDD$ per variazioni repentine del carico. In alto sono visibili, in funzione del tempo, le correnti analogiche e digitali. Quest'ultima, modificando la frazione di canali del ROC sui quali il clock \`e abilitato, cambia velocemente tra $300\mA$ e $500\mA$. In basso i grafici riportano il corrispondente andamento di $\VDDD$ misurato all'oscilloscopio confrontato con il profilo simulato.}
\label{LoadTransientScope}
\end{figure}
\begin{figure}[hb]
\centering
\includegraphics[width=0.65\textwidth]{Immagini/LoadTransientDominik}
\caption{Valori di picco della variazione della tensione $\VDDD$ in funzione del margine percentuale di corrente rispetto a $1\A$ nel caso in cui il carico su $\VDDD$ sia modificato in modo repentino tra $300\mA$ a $500\mA$. Il consumo della parte analogica \`e costante e calibrato su $\sim 0.5\A$. 
}
\label{LoadTransient}
\end{figure}
Una misura di estremo interesse è quella relativa alle fluttuazioni della tensione regolata dallo ShuntLDO per variazioni repentine del carico, Il principio della misura \`e visibile in~Fig.~\ref{LoadTransientScope}. La variazione controllata tra $300\mA$ a $500\mA$ della corrente assorbita dalla sola parte digitale si ottiene modificando la frazione di canali di lettura sui quali il clock \`e abilitato.  Il consumo della parte analogica \`e costante e calibrato su $\sim 0.5\A$ grazie ad una appropriata scelta dei parametri di funzionamento degli stadi di front end. All'oscilloscopio \`e possibile valutare, in corrispondenza dei transienti, la fluttuazione di tensione a cui \`e soggetta $\VDDD$. Queste fluttuazioni sono completamente compensate nel giro di qualche $\us$ e risultano in buon accordo con la simulazione circuitale, anch'essa riportata in~Fig.~\ref{LoadTransientScope}. 
Il valore di picco della fluttuazione di $\VDDD$ in funzione del margine di corrente fornito rispetto al totale della corrente richiesta, visibile in~Fig.~\ref{LoadTransient}, suggerisce che, per avere un corretto funzionamento della parte di alimentazione del ROC rispetto alle fluttuazioni del carico,  deve essere previsto un margine di sicurezza di circa il $20-25
\%$ sulla corrente di pilotaggio dello ShuntLDO rispetto al consumo di corrente massimo atteso. 

Una fase in cui le variazioni di corrente sono ovviamente massime \`e quella dell'accensione. Si è quindi proceduto a simulare una accensione veloce dell'alimentazione degli ShuntLDO  di RD53A in configurazione parallelo modificando $\Iin$ da $0\A$ a $2.4\A$ in $25\ms$ con un rampa lineare. Anche in questo caso i due ShuntLDO sono alimentati in parallelo, suddividendosi, quindi, la corrente erogata dal generatore. Come è possibile vedere dai profili temporali di $\VDDA$ e $\VDDD$, in Fig.~\ref{rd-powup-dir6} e Fig.~\ref{rd-powup-dir7} rispettivamente, acquisiti con un oscilloscopio con banda passante adeguata e confrontati con $\Iin$ e $\Vin$, non compaiono oscillazioni o altri comportamenti anomali.
La parte digitale e analogica non si attivano nello stesso momento, in particolare $\VDDD$ raggiunge pi\`u tardi la regione di regolazione rispetto a $\VDDA$ in accordo con quanto gi\`a osservato nelle misure stazionarie discusse precedentemente.

\begin{figure}
\centering
\includegraphics[scale=.3]{Immagini/rd-powup-dir6}
\caption{Profilo temporale di $\Iin$ (in giallo), $\Vin$ (rosa) e $\VDDA$ (blu). $\Iin$ varia da $0\A$ a $2.4\A$ in $25\ms$ con un rampa lineare.}
\label{rd-powup-dir6}
\end{figure}

\begin{figure}
\centering
\includegraphics[scale=.3]{Immagini/rd-powup-dir7}
\caption{Profilo temporale di $\Iin$ (in giallo), $\Vin$ (rosa) e $\VDDD$ (blu). $\Iin$ varia da $0\A$ a $2.4\A$ in $25\ms$ con un rampa lineare.}
\label{rd-powup-dir7}
\end{figure}

%Fino ad ora gli scan sono stati eseguiti lentamente, in confronto al tempo di risposta del circuito di alimentazione, infatti tra un valore di corrente ed il successivo vi è quasi un secondo.
Occorre osservare che si \`e scelta una situazione limite per lo studio del comportamento degli ShuntLDO. Nel rivelatore finale la sequenza di accensione dell'elettronica preveder\`a una rampa di salita della corrente molto pi\`u lenta con tempi caratteristici di qualche decimo di secondo.  

%
% RIPARTIRE DA QUI -------------------------------
%

%\section{Sviluppi}

% Questi studi sull'alimentazione seriale si collocano nelle più ampie attivit\`a di sviluppo del nuovo tracciatore di CMS per HL-LHC.
% In contemporanea a vengono sviluppi i sistemi di acquisizione dati in grado di dialogare con il chip e si stanno effettuando test sui tre \textit{front end} per studiarne la risposta prima e dopo processi di irraggiamento. 
% Lo sviluppo del circuito di alimentazione ha importanti legami con lo sviluppo del resto del chip.
% Ad esempio, la scelta di alimentare il chip separando la parte analogica da quella digitale deriva dalla necessità di proteggere la prima, più sensibile, dal rumore della seconda.
% Inoltre, prima di poter effettuare una qualsiasi azione a livello di chip, è necessario che lo stesso, una volta acceso, si trovi in una configurazione di default ben precisa.
% E' importante, quindi, che il processo di accensione, gestito dal circuito di ShuntLDO, avvenga correttamente: regione digitale e analogica devono attivarsi senza oscillazioni, durante il power-up, e drop di tensione. 
% %come detto il chip ha due regioni alimentate separatamente, digitale e analogica, questa scelta è dettata anche dalla necessità di proteggere la parte analogica, più sensibile, dal rumore della parte digitale. Se l'alimentazione fosse comune il rumore della parte digitale del chip andrebbe ad intaccare la parte analogica che è molto sensibile da questo punto di vista. 
% %Inoltre per operare una qualsiasi azione a livello di chip è necessario che lo stesso, una volta acceso, si trovi in una configurazione di default ben precisa, la corretta accensione è un problema legato al circuito di ShuntLDO, regione digitale e analogica devono attivarsi correttamente evitando oscillazioni durante il power-up e drop di tensione. 
% %Risulta quindi chiaro lo stretto legame che vi è tra alimentazione e sviluppo del chip. 

% All'interno del lavoro di tesi è stato possibile approcciarsi allo sviluppo del sistema di acquisizione, attraverso lo studio di alcuni prototipi.
% Nei prossimi paragrafi daremo una breve descrizione del sistema di acquisizione utilizzato e dei primi risultati ottenuti sulle soglie di lettura e sulla relativa distribuzione di rumore. 
% %All'interno del lavoro di tesi è stato possibile anche un primo approccio allo sviluppo del sistema di acquisizione, in quanto lo studio riguarda oggetti attualmente in evoluzione essendo prototipi. L'approccio al sistema di DAQ rappresenta naturale in un'ottica di sviluppo del progetto di RD53A. A seguito diamo una breve descrizione del sistema di acquisizione utilizzato e dei primi risultati ottenuti su soglie di lettura e la relativa distribuzione di rumore. 



% %problemi legati a tensioni di riferimento troppo basse non riesce a dare Phase locked loop non sempre riesce, tensioni di otput troppo basse, causa dei vref bassi per problemi di progettazione dei circuiti di band gap, ma se non fa il pll nonn lo posso configurare a valori più alti.

\section{Prove con il sistema di acquisizione dati di RD53A}

Oltre alla caratterizzazione dello ShuntLDO come elemento circuitale a se stante \`e ovviamente molto importante valutare l'interazione del sistema di alimentazione con le prestazioni del ROC. \`E di fondamentale importanza verificare che le linee di alimentazione non introducano rumore indesiderato negli ambiti in cui il ROC tratta segnali di piccola entit\`a e quindi, in particolare, negli stadi di front end (dove il segnale di particella viene amplificato) e, in presenza del sensore, nella maglia in cui il segnale di particella stesso viene generato. 
Per una ragione analoga la parte digitale e la parte analogica del ROC sono mantenute il pi\`u possibile isolate e sono anche alimentate separatamente. La parte analogica infatti, ben più sensibile, deve essere protetta dal potenziale rumore indotto dall'attivit\`a della parte digitale. Questo sforzo sarebbe vanificato se fosse l'alimentazione stessa a introdurre rumore.

Questo tipo di verifica richiede l'uso di un sistema completo di acquisizione dati per RD53A in grado di configurare e pilotare il ROC, effettuare le principali procedure di calibrazione e, in ultima analisi, misurare il rumore canale per canale. Questa sezione discute alcuni test preliminari effettuati con un sistema di DAQ. Questi test saranno largamente estesi nel prossimo futuro per una approfondita caratterizzazione.

Due sono i sistemi di acquisizione dati per RD53A attualmente in sviluppo: Yarr~\cite{YARR} (\textit{Yet Another Rapid Readout}), sviluppato dal Lawrence Berkeley National Laboratory, e BDAQ~\cite{BDAQ}, sviluppato dall'Università di Bonn. Entrambi si basano su FPGA XILINX~\cite{xilinx} per comunicare con il chip. 
%Attraverso questi sistemi di acquisizione, sul cui sviluppo e le particolari caratteristiche non ci soffermeremo, non essendo questo il principale obbiettivo di questo lavoro di tesi, è possibile al momento vari test. 
Gli studi effettuati nell'ambito di questo lavoro di tesi si basano sul sistema di acquisizione BDAQ che, pur essendo tutt'ora in fase di sviluppo, supporta, tra le altre, le seguenti procedure di base:
\begin{description}

\item[scan$\_$digital] La scansione digitale consiste nella `iniezione' nei canali abilitati, a valle degli stadi di front end e di conversione analogico-digitale, di un segnale digitale per verificare la funzionalità della parte digitale del ROC. L'operazione \`e ripetuta un certo numero di volte e si misura l'efficienza con cui ciascun canale registra il segnale iniettato. Per un canale funzionante correttamente questa efficienza \`e 1.%This basic scan injects a digital pulse into enabled pixels to test the digital part of the chip.

\begin{figure}
\centering
\includegraphics[width=\textwidth]{Immagini/ScanAnalogLinear}
\caption{Risultato del test \textbf{scan$\_$analog} sulla \textit{front end} lineare, tutti i canali di lettura hanno risposto il 100$\%$ delle volte.}
\label{ScanAnalogLinear}
\end{figure}

\item[scan$\_$analog] La scansione analogica \`e simile alla precedente ma dedicata alla parte analogica: un impulso che emula il segnale di particella corrispondente ad una quantit\`a di carica raccolta configurabile viene iniettato nei canali abilitati all'ingresso dello stadio di amplificazione in modo da verificare il funzionamento di tutta la catena di lettura ma, in particolare, dei front end analogici. Anche in questa scansione l'operazione \`e ripetuta un certo numero di volte e si misura l'efficienza con cui ciascun canale registra il segnale iniettato. Per un canale funzionante correttamente, se il segnale iniettato \`e sufficientemente maggiore della soglia, questa efficienza \`e 1. Un esempio di scansione analogica (limitato alla sola regione del ROC servita dal front end lineare) è mostrato in Fig.~\ref{ScanAnalogLinear}. %This basic scan injects a specified charge into enabled pixels to test the analog front-end. 

\item[scan$\_$threshold] La scansione di soglia \`e dedicata alla misura della soglia effettiva e del rumore di ciascun canale abilitato. Queste quantità si derivano misurando l'efficienza del canale in funzione della carica del segnale di calibrazione. Per segnali di calibrazione vicini al valore di soglia, il superamento o meno di questa dipende dal rumore che, per ciascuna iniezione, si somma al segnale di calibrazione. 
Per questo motivo la curva di efficienza in funzione della carica del segnale di calibrazione, invece di essere una funzione a gradino, assume il caratteristico profilo a `S' ({\em S-curve}) dal cui fit \`e possibile ottenere il valore di soglia e di rumore del canale.
Infatti la S-curve è descritta dalla funzione:
\begin{equation}
  \mathrm{S_{curve} = \frac{1}{2} \left( 1 + \erf \left( \frac{q-\mu}{\sqrt{2}\sigma} \right) \right)},
\end{equation}
dove q \`e il segnale di calibrazione, $\mu$ la soglia e $\sigma$ il rumore espressi in unit\`a omogenee (carica equivalente, per esempio). La funzione $\erf(x)$ \`e la `error function' cos\`i definita:
\begin{equation}
 \erf(x) = \frac{1}{\sqrt(\pi)}\int_{-x}^{x} e^{-t^2}dt.
\end{equation}
I valori di $\mu$ e $\sigma$ sono ricavati con il metodo descritto in~\cite{ERF}.

La sovrapposizione delle S-curve di ogni canale produce un grafico come quello riportato in Fig.~\ref{Scurves} dove l'asse $z$ (espressa in colore) rappresenta il numero di canali che si sono accesi una certa frazione percentuale di volte ({\em occupancy}), per un dato valore di $\mathrm{\Delta VCAL}$ (che \`e una quantit\`a proporzionale al segnale di calibrazione tale per cui ad una unit\`a di $\mathrm{VCAL}$ corrisponde una carica di 10e$^-$).
\begin{figure}
\centering
\includegraphics[width=0.9\textwidth]{Immagini/Scurves}
\caption{Risultato del test \textbf{scan$\_$threshold}: l'asse $z$ (espressa in colore) rappresenta il numero di canali che, per un valore $\mathrm{\Delta Vcal}$ (proporzionale al segnale di calibrazione), si sono accesi una certa frazione percentuale di volte ({\em occupancy}).}
\label{Scurves}
\end{figure}
La distribuzione delle soglie, con sovrapposto il fit di una gaussiana, e la mappa del rumore dei canali ricavate dalle S-curve sono visibile in Fig.~\ref{Threshold}. Le misure riportate fanno riferimento solo al \textit{front end} lineare, in quanto, al momento del test, questo era l'unico supportato da una versione sufficientemente avanzata e stabile del software.
\begin{figure}
\centering
\includegraphics[width=0.4\textwidth]{Immagini/Threshold}
\hfill
\includegraphics[width=0.58\textwidth]{Immagini/NoiseMap}
\caption{Distribuzione delle soglie ottenute dalle S-curves (sinistra) e mappa del livello di rumore pixel per pixel per il FE lineare (destra).}
\label{Threshold}
\label{NoiseMap}
\end{figure}

\item[meta$\_$tune$\_$threshold$\_$simple] La scansione fine delle soglie \`e una procedura che permette di equalizzare le soglie della matrice di pixel calibrando, canale per canale, il DAC a 4 bit concepito per questo scopo. Questo introduce una regolazione fine della soglia rispetto alla soglia globale di tutto il ROC.
\end{description}

Grazie alle procedure sopra descritte, anche in assenza di un sensore connesso al chip, \`e possibile verificare separatamente le funzionalità della parte analogica e digitale del ROC; analizzare la risposta dei tre \textit{front end} ad un segnale di calibrazione; ricavare le distribuzioni delle soglie e del rumore e ottimizzare localmente le soglie.

%Queste procedure sono implementate sotto forma di script in python che leggono i parametri dei registri del ROC da un apposito file di configurazione trasmettendoli cos\`i al ROC stesso.
%Altro file importante è il file contenente i parametri di configurazione dei registri \textbf{default$\_$chip.yaml}, che ogni volta che uno scan viene lanciato vengono scritti nel chip. 
% (per \textit{front end} lineare e differenziale). 
% RIPARTIRE DA QUI
%Attraverso questi test è possibile, anche senza aver collegato un sensore al chip, controllare le funzionalità di parte analogica e digitale separatamente, analizzare la risposta dei tre \textit{front end} ad un segnale di calibrazione, ricavare una distribuzione delle soglie, la distribuzione del rumore e ottimizzare le soglie localmente (per \textit{front end} lineare e differenziale). 

% A livello di questo lavoro di tesi risulta interessante esaminare il comportamento del circuito di alimentazione mentre il ROC esegue una di queste procedure e in presenza, quindi, di variazioni nella corrente assorbita. Ad esempio, durante il test scan$\_$threshold, la parte analogica verifica il livello di soglia di ogni pixel andando a iniettare un segnale via via crescente. In questa situazione ci sono variazioni nella corrente necessaria al nucleo del ROC di non piccola entit\`a che possono essere sfruttate per confrontare le diverse tipologie di alimentazione.

% \subsubsection{LDO vs. ShuntLDO}

% Come prima prova confrontiamo la differenza di comportamento del chip quando si utilizza o meno il regolatore con lo Shunt, mantenendo, comunque, sempre attiva la parte di LDO.
% %Una prima prova che è interessante eseguire consiste nel confrontare una situazione in cui è utilizzato il regolatore con lo Shunt e una situazione in cui non è utilizzato lo Shunt e il chip è alimentato in configurazione LDO. In seguito è lecito chiedersi se, effettivamente in una catena seriale di due chip l'attivita di uno non influenza l'altro. Cioè se il circuito di ShuntLDO riesce ad nascondere al chip eventuali fluttuazioni e rumore  che vi sono nella catena.

% \begin{figure}
% \centering
% \includegraphics[width=0.9\textwidth]{Immagini/alllin1}
% \caption{Variazione di $\VDDD$ (verde, 100 mV/div) e $\VDDA$ (blu, 20 mV/div) in corrispondenza dell'iniezione di un impulso di calibrazione. Base dei tempi $\mathrm{20\us/div}$.}
% \label{alllin1}
% \end{figure}
% \begin{figure}
% \centering
% \includegraphics[width=0.9\textwidth]{Immagini/alllin2}
% \caption{VDDD in verde con scala 50 mV/div., e VDDA, in blu con scala 20 mV/div. Base dei tempi $\mathrm{5\us/div}$.}
% \label{alllin2}
% \end{figure}

% La misura effettuata consiste nel monitorare le tensioni di alimentazione, $\VDDD$ e $\VDDA$, mentre attraverso il sistema di acquisizione si richiede al chip di eseguire il test scan$\_$threshold. Per cercare di massimizzare gli effetti è stato aumentato il numero di pixel in cui viene iniettato contemporaneamente un segnale di calibrazione relativamente grande. In questo modo è stato possibile verificare gli effetti causati dalle variazioni di carico proprie dell'attività del chip.
% Dal confronto tra i risultati ottenuti in configurazione con o senza shunt è emersa chiaramente l'importanza di questo elemento, non solo per evitare che un malfunzionamento del chip renda inutilizzabile tutta la catena, ma anche per rendere stabili le tensioni generate dal regolatore. 
% In Fig.~\ref{alllin1}, infatti, sono riportate le tensioni $\VDDD$ e $\VDDA$ utilizzando il chip senza Shunt, quindi alimentato in tensione con il solo LDO attivo.
% Durante il dialogo con il sistema di acquisizione si sono verificate variazioni notevoli nelle tensioni.
% Con le stessse condizioni, ma utilizzando lo shunt, gli sbalzi di tensione, come si può vedere in figura \ref{alllin2}, spariscono poiché le variazioni di carico sono gestite localmente.
% In modalità LDO, invece, l'alimentazione è in tensione ed è il generatore esterno ad adattare la corrente erogata ai consumi del chip.

% %\begin{figure}
% %\centering
% %\includegraphics[scale=.3]{Immagini/}
% %\caption{.}
% %\label{}
% %\end{figure}

% %-----------------------------------------------------------
% Andremo poi a vedere se, data la catena seriale di due chip, le attività di queste sono indipendenti o si influenzano a vicenda, i.e. se il circuito di ShuntLDO riesce a nascondere, al chip, il rumore e le eventuali fluttuazioni che vi sono nella catena.
% Studiamo ora i vantaggi effettivi dell'utilizzo di un circuito di alimentazione che implementi uno Shunt oltre al regolatore.
% %------------------------------------------------------------

%\subsubsection{BDAQ}

% %Prima di procedere con la presentazione dei risultati è necessario dare almento un'idea guida di che operazione vengono eseguite durante lo scan delle soglie al fine di comprendere meglio il significato delle varie distribuzioni.
% Lo scan delle soglie, descritto all'inizio del paragrafo, permette, attraverso i parametri di configurazione, di decidere una soglia globale, uguale per tutti i canali di lettura, che nella pratica, però, varierà leggermente tra un canale e l'altro. 
% %Attraverso i parametri di configurazione è possibile decidere una soglia globale uguale per tutti i canali di lettura, nella pratica però la soglia varierà leggermente tra un canale e l'altro. 
% Ci si aspetta, quindi, una distribuzione delle soglie intorno ad un valore centrale.
% Inoltre, a causa del rumore, la risposta del circuito di lettura in funzione della carica raccolta non sarà una theta: il rumore, che si somma al segnale, può far scattare il discriminatore anche a segnali più piccoli della soglia.
% Se su ciascun canale iniettiamo un segnale sempre più grande, ripetendo il processo più volte e riportando il numero delle volte in cui il discriminatore scatta in funzione del segnale iniettato, si ottengono le così dette Scurves che, senza rumore, sarebbero a gradino. 
% Dal fit di ogni singola Scurve è possibile ottenere il valore di soglia e di rumore di ogni canale.
% Infatti la Scurve è descritta dalla funzione:
% \begin{equation}
%   \mathrm{S_{curve} = \frac{A}{2} \left( 1 + \erf \left( \frac{q-\mu}{\sqrt{2}\sigma} \right) \right)},
% \end{equation}
% dove A è l'ampiezza della $\erf$, $\mu$ la soglia e $\sigma$ il rumore.
% I valori di $\mu$ e $\sigma$ sono ricavati con il metodo descritto in \cite{ERF}.


%Dal fit della singola Scurves si ricava un valore di soglia e rumore, mettendo insieme i risultati per tutti i canali si ottengolo le distribuzioni delle stesse, in figura\ref{Threshold} è riportata la distribuzione delle soglie. 
%Il test restituisce, oltre alle distribuzioni, anche le mappe di soglie e rumore utili per verificare l'omogeneità della risposta e la presenza di zone più rumorose o a rumore nullo, sintomatiche di problemi.
%La soglia è il livello minimo a cui l'elettronica risponde, se non ci fosse rumore le S-curves sarebbero gradini, nella realtà a causa del rumore che si somma al segnale questi gradini ideali diventano curve, meno assomiglia ad un gradino maggiore è il rumore.

\begin{figure}
\centering
\includegraphics[width=0.70\textwidth]{Immagini/chipserial}
\caption{Fotografia del setup, i due chip posti sulla Single Chip Card sono al centro e ognuno di essi è collegato a una FPGA che gestisce la comunicazione tra RD53A e il computer.}
\label{chipserial}
\end{figure}
Come detto in precedenza l'utilizzo degli ShuntLDO dovrebbe evitare il propagarsi del rumore dalla parte digitale a quella analogica ed evitare che disturbi della linea vengano visti dal carico. 
Al fine di verificare eventuali correlazioni tra l'entit\`a del rumore e l'utilizzo dell'alimentazione seriale, si sono messi a confronto i risultati di test eseguiti prima, alimentando un singolo ROC sulla catena, e poi i risultati dei medesimi test su una coppia di ROC operati in in configurazione di alimentazione seriale o parallela. Si \`e usato il banco di misura visibile in Fig.~\ref{chipserial}. Tutte le misure sono state eseguite alimentando il ROC in configurazione  ShuntLDO.

%
% --------------------------------- QUI
%

\begin{figure}[h]
\centering
\includegraphics[width=0.49\textwidth]{Immagini/NoiseSingle}
\hfill
\includegraphics[width=0.49\textwidth]{Immagini/NoiseSerial}

\includegraphics[width=0.50\textwidth]{Immagini/NoiseParallel}
\caption{Distribuzioni di rumore di un ROC ottenute attraverso il test di \textbf{scan$\_$threshold} in varie configurazioni: un singolo ROC alimentato con ShuntLDO; ROC alimentato in una serie di due con scansioni effettuate su entrambi in contemporanea; ROC alimentato in parallelo a un secondo. Nelle ultime due configurazioni le scansioni sono effettuate su entrambi in contemporanea. Il rumore medio estratto dal fit alle distribuzioni risulta pari a 99e$^-$, 95e$^-$ e 94e$^-$ per le tre configurazioni, rispettivamente.}
\label{noisesingle}
\label{noiseserial}
\label{noiseparallel}
\end{figure}

Le distribuzioni di rumore ottenute nei tre casi sono mostrate in~Fig.~\ref{noisesingle}. Il rumore medio misurato, stimato con un fit gaussiano alle distribuzioni, risulta pari a 99e$^-$, 95e$^-$ e 94e$^-$ per le tre configurazioni, rispettivamente. Come si può vedere le distribuzioni del rumore delle configurazioni con due ROC in serie e in parallelo non peggiorano rispetto al caso con il ROC singolo, nonostante che, su queste ultime, tutti i ROC del sistema in prova fossero soggetti ad iniezione di carica e attività digitale. Questo primo risultato, al momento limitato e molto preliminare, sembrerebbe indicare che lo ShuntLDO compia un efficace filtraggio delle linee di alimentazione (sia internamente che esternamente) rispetto alle sollecitazioni indotte dal nucleo del ROC da questo alimentato.

Questo \`e compatibile con la verifica, a pi\`u basso livello, delle fluttuazioni di $\VDDD$ e $\VDDA$ mentre, tramite il sistema di acquisizione, si richiede al chip di eseguire il test scan$\_$threshold. Per cercare di massimizzare le potenziali interferenze, un segnale di calibrazione relativamente grande \`e iniettato su molti pi\`u canali del normale. In questo modo è possibile verificare gli effetti causati dalle variazioni di carico proprie dell'attività del chip. L'andamento temporale osservato all'oscilloscopio \`e mostrato in~Fig.~\ref{alllin2}.
\begin{figure}
\centering

\includegraphics[width=0.9\textwidth]{Immagini/alllin2}
\caption{Variazione di $\VDDD$ (verde, 50 mV/div) e $\VDDA$ (blu, 20 mV/div) in corrispondenza dell'attivit\`a di calibrazione testimoniata dalle tracce digitali (giallo e rosa). La base dei tempi del grafico \`e $\mathrm{20\us/div}$.}
\label{alllin2}

\end{figure}
Le fluttuazioni osservabili sono limitate a qualche mV in ampiezza e dunque assolutamente compatibili con i requisiti.

Tutte le misure effettuate nell'ambito di questo lavoro di tesi, pur rappresentando solo una porzione preliminare dei risultati che verranno raccolti in tutta la campagna di validazione del disegno dell'IT nel suo complesso, indicano che l'alimentazione seriale e lo ShuntLDO siano assolutamente conformi ai requisiti richiesti. Gli studi che verranno effettuati nei prossimi mesi, non ultimi quelli relativi alla caratterizzazione del ROC e dello ShuntLDO dopo irraggiamento e pi\`u ampi test di sistema, daranno il via libera definitivo all'approccio dell'alimentazione seriale basata su ShuntLDO per l'IT di CMS a HL-LHC. 

% Dal confronto tra i risultati ottenuti in configurazione con o senza shunt è emersa chiaramente l'importanza di questo elemento, non solo per evitare che un malfunzionamento del chip renda inutilizzabile tutta la catena, ma anche per rendere stabili le tensioni generate dal regolatore. 
% In Fig.~\ref{alllin1}, infatti, sono riportate le tensioni $\VDDD$ e $\VDDA$ utilizzando il chip senza Shunt, quindi alimentato in tensione con il solo LDO attivo.
% Durante il dialogo con il sistema di acquisizione si sono verificate variazioni notevoli nelle tensioni.
% Con le stessse condizioni, ma utilizzando lo shunt, gli sbalzi di tensione, come si può vedere in figura \ref{alllin2}, spariscono poiché le variazioni di carico sono gestite localmente.

